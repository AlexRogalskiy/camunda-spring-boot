<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" id="Definitions_05yd4j2" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="4.1.1">
  <bpmn:collaboration id="Collaboration_1y6khm4">
    <bpmn:participant id="Participant_17tghh4" name="Запрос предоставления доступа" processRef="access" />
    <bpmn:participant id="Participant_12wxi95" name="Рассмотрение предоставления доступа" processRef="Process_0nwicon" />
    <bpmn:messageFlow id="Flow_04ij7bl" sourceRef="Event_1j1x5ji" targetRef="Event_0gpd48d" />
    <bpmn:messageFlow id="Flow_0r1za9f" sourceRef="Event_03uihrb" targetRef="Event_0ksblc0" />
  </bpmn:collaboration>
  <bpmn:process id="access" name="Предоставление доступа" isExecutable="true">
    <bpmn:laneSet id="LaneSet_0fqntog">
      <bpmn:lane id="Lane_0x1yfuw" name="Пользователь">
        <bpmn:flowNodeRef>Event_1e9sejc</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Activity_1pj31mn</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Gateway_1knnds5</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Event_0sf14gc</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Activity_1nji1cd</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Gateway_01deh34</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Event_0ksblc0</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Event_1j1x5ji</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Activity_0xsj9r9</bpmn:flowNodeRef>
      </bpmn:lane>
    </bpmn:laneSet>
    <bpmn:startEvent id="Event_1e9sejc" name="Нужен доступ к сущности" camunda:initiator="initiator">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="entityId" label="Идентификатор сущности" type="long" />
          <camunda:formField id="username" label="Имя пользователя" type="string" defaultValue="${ currentUser() }" />
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:outgoing>Flow_153otsc</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:userTask id="Activity_1pj31mn" name="В доступе отказано" camunda:assignee="${ initiator }">
      <bpmn:incoming>Flow_0qrajgy</bpmn:incoming>
      <bpmn:outgoing>Flow_0ogigov</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="Gateway_1knnds5">
      <bpmn:incoming>Flow_0qq23j7</bpmn:incoming>
      <bpmn:incoming>Flow_0ogigov</bpmn:incoming>
      <bpmn:outgoing>Flow_15hppst</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:endEvent id="Event_0sf14gc">
      <bpmn:incoming>Flow_15hppst</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:userTask id="Activity_1nji1cd" name="Доступ предоставлен" camunda:assignee="${ initiator }">
      <bpmn:incoming>Flow_136id1q</bpmn:incoming>
      <bpmn:outgoing>Flow_0qq23j7</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="Gateway_01deh34">
      <bpmn:incoming>Flow_0rfulgj</bpmn:incoming>
      <bpmn:outgoing>Flow_0qrajgy</bpmn:outgoing>
      <bpmn:outgoing>Flow_136id1q</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:intermediateCatchEvent id="Event_0ksblc0">
      <bpmn:outgoing>Flow_0rfulgj</bpmn:outgoing>
      <bpmn:messageEventDefinition id="MessageEventDefinition_1nphv6m" messageRef="Message_1j9ztqq" />
    </bpmn:intermediateCatchEvent>
    <bpmn:endEvent id="Event_1j1x5ji">
      <bpmn:incoming>Flow_1mrqd3a</bpmn:incoming>
      <bpmn:messageEventDefinition id="MessageEventDefinition_1al0c9j" messageRef="Message_13e9xw6" camunda:delegateExpression="${ sendAccessRequest }" />
    </bpmn:endEvent>
    <bpmn:serviceTask id="Activity_0xsj9r9" name="Создать запись доступа" camunda:delegateExpression="${ createAccessRequest }">
      <bpmn:incoming>Flow_153otsc</bpmn:incoming>
      <bpmn:outgoing>Flow_1mrqd3a</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_153otsc" sourceRef="Event_1e9sejc" targetRef="Activity_0xsj9r9" />
    <bpmn:sequenceFlow id="Flow_0qrajgy" sourceRef="Gateway_01deh34" targetRef="Activity_1pj31mn">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${ approve == "false" }</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_136id1q" sourceRef="Gateway_01deh34" targetRef="Activity_1nji1cd">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${ approve == "true" }</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_0qq23j7" sourceRef="Activity_1nji1cd" targetRef="Gateway_1knnds5" />
    <bpmn:sequenceFlow id="Flow_0ogigov" sourceRef="Activity_1pj31mn" targetRef="Gateway_1knnds5" />
    <bpmn:sequenceFlow id="Flow_15hppst" sourceRef="Gateway_1knnds5" targetRef="Event_0sf14gc" />
    <bpmn:sequenceFlow id="Flow_1mrqd3a" sourceRef="Activity_0xsj9r9" targetRef="Event_1j1x5ji" />
    <bpmn:sequenceFlow id="Flow_0rfulgj" sourceRef="Event_0ksblc0" targetRef="Gateway_01deh34" />
  </bpmn:process>
  <bpmn:process id="Process_0nwicon" isExecutable="false">
    <bpmn:startEvent id="Event_0gpd48d">
      <bpmn:outgoing>Flow_1lqzkej</bpmn:outgoing>
      <bpmn:messageEventDefinition id="MessageEventDefinition_0m2axsg" messageRef="Message_13e9xw6" />
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="Flow_099ka5q" sourceRef="Activity_0q41zea" targetRef="Activity_1p7qjsk" />
    <bpmn:sequenceFlow id="Flow_1lqzkej" sourceRef="Event_0gpd48d" targetRef="Activity_0q41zea" />
    <bpmn:sequenceFlow id="Flow_0pxau0g" sourceRef="Activity_1p7qjsk" targetRef="Event_03uihrb" />
    <bpmn:userTask id="Activity_0q41zea" name="Согласовать доступ" camunda:assignee="alice">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="entityId" type="long" />
          <camunda:formField id="username" label="Имя инициатора" type="string" />
          <camunda:formField id="approve" label="Согласование доступа" type="enum" defaultValue="null">
            <camunda:value id="null" name="== Выберите решение ==" />
            <camunda:value id="true" name="Согласовано" />
            <camunda:value id="false" name="Отказано" />
          </camunda:formField>
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1lqzkej</bpmn:incoming>
      <bpmn:outgoing>Flow_099ka5q</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:serviceTask id="Activity_1p7qjsk" name="Обновить запись доступа" camunda:delegateExpression="${ updateAccessRequest }">
      <bpmn:incoming>Flow_099ka5q</bpmn:incoming>
      <bpmn:outgoing>Flow_0pxau0g</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:endEvent id="Event_03uihrb">
      <bpmn:incoming>Flow_0pxau0g</bpmn:incoming>
      <bpmn:messageEventDefinition id="MessageEventDefinition_0owpfp4" messageRef="Message_10wengt" camunda:delegateExpression="${ sendAccessResponse }" />
    </bpmn:endEvent>
  </bpmn:process>
  <bpmn:message id="Message_13e9xw6" name="AccessRequest" />
  <bpmn:message id="Message_10wengt" name="AccessResponse" />
  <bpmn:message id="Message_1j9ztqq" name="AccessResponse" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Collaboration_1y6khm4">
      <bpmndi:BPMNShape id="Participant_17tghh4_di" bpmnElement="Participant_17tghh4" isHorizontal="true">
        <dc:Bounds x="160" y="80" width="1120" height="460" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_0x1yfuw_di" bpmnElement="Lane_0x1yfuw" isHorizontal="true">
        <dc:Bounds x="190" y="80" width="1090" height="460" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_153otsc_di" bpmnElement="Flow_153otsc">
        <di:waypoint x="298" y="230" />
        <di:waypoint x="400" y="230" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0qrajgy_di" bpmnElement="Flow_0qrajgy">
        <di:waypoint x="815" y="310" />
        <di:waypoint x="760" y="310" />
        <di:waypoint x="760" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_136id1q_di" bpmnElement="Flow_136id1q">
        <di:waypoint x="865" y="310" />
        <di:waypoint x="910" y="310" />
        <di:waypoint x="910" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0qq23j7_di" bpmnElement="Flow_0qq23j7">
        <di:waypoint x="910" y="190" />
        <di:waypoint x="910" y="165" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0ogigov_di" bpmnElement="Flow_0ogigov">
        <di:waypoint x="760" y="190" />
        <di:waypoint x="760" y="140" />
        <di:waypoint x="885" y="140" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_15hppst_di" bpmnElement="Flow_15hppst">
        <di:waypoint x="935" y="140" />
        <di:waypoint x="1072" y="140" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1mrqd3a_di" bpmnElement="Flow_1mrqd3a">
        <di:waypoint x="450" y="270" />
        <di:waypoint x="450" y="352" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0rfulgj_di" bpmnElement="Flow_0rfulgj">
        <di:waypoint x="840" y="372" />
        <di:waypoint x="840" y="335" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Event_1e9sejc_di" bpmnElement="Event_1e9sejc" bioc:stroke="#000" bioc:fill="#fff">
        <dc:Bounds x="262" y="212" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="241" y="255" width="79" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0381bhq_di" bpmnElement="Activity_1pj31mn">
        <dc:Bounds x="710" y="190" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1knnds5_di" bpmnElement="Gateway_1knnds5" isMarkerVisible="true">
        <dc:Bounds x="885" y="115" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0sf14gc_di" bpmnElement="Event_0sf14gc">
        <dc:Bounds x="1072" y="122" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_028sjz2_di" bpmnElement="Activity_1nji1cd">
        <dc:Bounds x="860" y="190" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_01deh34_di" bpmnElement="Gateway_01deh34" isMarkerVisible="true">
        <dc:Bounds x="815" y="285" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_19n4x64_di" bpmnElement="Event_0ksblc0">
        <dc:Bounds x="822" y="372" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1fbr0ov_di" bpmnElement="Event_1j1x5ji">
        <dc:Bounds x="432" y="352" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0z06d4k_di" bpmnElement="Activity_0xsj9r9">
        <dc:Bounds x="400" y="190" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Participant_12wxi95_di" bpmnElement="Participant_12wxi95" isHorizontal="true">
        <dc:Bounds x="160" y="680" width="780" height="250" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_099ka5q_di" bpmnElement="Flow_099ka5q">
        <di:waypoint x="620" y="810" />
        <di:waypoint x="660" y="810" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1lqzkej_di" bpmnElement="Flow_1lqzkej">
        <di:waypoint x="468" y="810" />
        <di:waypoint x="520" y="810" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0pxau0g_di" bpmnElement="Flow_0pxau0g">
        <di:waypoint x="760" y="810" />
        <di:waypoint x="822" y="810" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Event_0r6lekj_di" bpmnElement="Event_0gpd48d">
        <dc:Bounds x="432" y="792" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_17jql63_di" bpmnElement="Activity_0q41zea">
        <dc:Bounds x="520" y="770" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0ikgjez_di" bpmnElement="Activity_1p7qjsk">
        <dc:Bounds x="660" y="770" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0sswc8g_di" bpmnElement="Event_03uihrb">
        <dc:Bounds x="822" y="792" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_04ij7bl_di" bpmnElement="Flow_04ij7bl">
        <di:waypoint x="450" y="388" />
        <di:waypoint x="450" y="792" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0r1za9f_di" bpmnElement="Flow_0r1za9f">
        <di:waypoint x="840" y="792" />
        <di:waypoint x="840" y="408" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
